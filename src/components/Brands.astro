---
import type { CollectionEntry } from "astro:content";

type Props = CollectionEntry<"pages">["data"]["brands"];

const { title, highlight, list } = Astro.props as Props;
---

<section class="py-12 border-y border-white/5 bg-white/5 overflow-hidden">
  <div class="max-w-7xl mx-auto px-6 md:px-12 text-center mb-8">
    <h3 class="text-xl font-semibold text-white">
      {title}
      <span class="text-blue-500">{highlight}</span>
    </h3>
  </div>

  <div class="relative group w-full">
    <!-- Carousel Container -->
    <div
      id="brands-carousel"
      class="flex overflow-x-auto snap-x snap-mandatory scrollbar-hide w-full"
      style="scroll-behavior: smooth;"
    >
      {
        list.map((brand) => (
          <div class="snap-start shrink-0 box-border w-1/2 md:w-1/4 lg:w-1/5 p-4 flex justify-center">
            <a
              href={brand.link || "#"}
              target="_blank"
              rel="noopener noreferrer"
              class="w-full aspect-[16/9] flex items-center justify-center bg-white rounded-2xl shadow-sm border border-gray-100 p-6 transition-transform hover:scale-105 duration-300"
            >
              <img
                src={brand.logo}
                alt={brand.name}
                class="max-w-full max-h-full object-contain filter grayscale hover:grayscale-0 transition-all duration-300"
                loading="lazy"
              />
            </a>
          </div>
        ))
      }
    </div>
  </div>
</section>

<script>
  const carousel = document.getElementById("brands-carousel");
  let intervalId: number | undefined;

  const startAutoScroll = () => {
    // Clear any existing interval to prevent duplicates
    if (intervalId) clearInterval(intervalId);

    // Only scroll if there's more content than fits
    if (carousel && carousel.scrollWidth <= carousel.clientWidth) return;

    intervalId = window.setInterval(() => {
      if (!carousel) return;

      const item = carousel.querySelector(".snap-start");
      const scrollAmount = item ? (item as HTMLElement).offsetWidth : 300;
      const maxScroll = carousel.scrollWidth - carousel.clientWidth;

      if (carousel.scrollLeft >= maxScroll - 10) {
        carousel.scrollTo({ left: 0, behavior: "smooth" });
      } else {
        carousel.scrollBy({ left: scrollAmount, behavior: "smooth" });
      }
    }, 2000); // 2 seconds per scroll
  };

  const stopAutoScroll = () => {
    if (intervalId) clearInterval(intervalId);
  };

  if (carousel) {
    // Check initially and on resize
    startAutoScroll();
    window.addEventListener("resize", startAutoScroll);

    // Pause on interaction
    carousel.addEventListener("mouseenter", stopAutoScroll);
    carousel.addEventListener("mouseleave", startAutoScroll);
    carousel.addEventListener("touchstart", stopAutoScroll);
    carousel.addEventListener("touchend", () => {
      // Wait a bit before restarting after touch
      setTimeout(startAutoScroll, 3000);
    });
  }
</script>

<style>
  /* Hide scrollbar for Chrome, Safari and Opera */
  .scrollbar-hide::-webkit-scrollbar {
    display: none;
  }

  /* Hide scrollbar for IE, Edge and Firefox */
  .scrollbar-hide {
    -ms-overflow-style: none; /* IE and Edge */
    scrollbar-width: none; /* Firefox */
  }
</style>
