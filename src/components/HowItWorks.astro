---
import type { CollectionEntry } from "astro:content";

type Props = CollectionEntry<"pages">["data"]["howItWorks"];

const { label, title, image, steps } = Astro.props as Props;
---

<section id="how-it-works-section" class="bg-gradient-to-br from-[#050a1f] via-blue-900 to-blue-800 p-[25px] w-full transition-colors duration-300">
  <div id="how-it-works-inner" class="bg-black rounded-[3rem] py-20 transition-colors duration-300">
    <div class="max-w-7xl mx-auto px-4 md:px-8 relative z-10">
        
        <!-- Header -->
        <div class="text-center mb-16">
          <span class="text-blue-400 font-bold uppercase tracking-widest text-sm mb-2 block">
            {label}
          </span>
          <h2 class="text-4xl md:text-5xl font-bold font-outfit text-white">
            {title}
          </h2>
        </div>

        <div class="grid grid-cols-1 lg:grid-cols-2 gap-12 lg:gap-20 items-center">
          
          <!-- Image Section -->
          <div class="relative hiw-image opacity-0 translate-y-8">
              <div class="rounded-3xl overflow-hidden shadow-2xl h-full min-h-[400px]">
              <img
                src={image}
                alt="How it works"
                class="w-full h-full object-cover"
              />
            </div>
          </div>

          <!-- Steps Section -->
          <div class="space-y-0 relative">
            <!-- Continuous Vertical Line -->
            <div class="absolute left-8 top-8 bottom-8 w-px border-l-2 border-dashed border-gray-600 hidden md:block"></div>

            {
              steps.map((step, index) => (
                <div class="hiw-step flex gap-6 md:gap-8 relative pb-12 last:pb-0 opacity-0 translate-x-8">
                  <!-- Icon -->
                  <div class="relative z-10 shrink-0">
                    <div class="w-16 h-16 rounded-full bg-blue-600 flex items-center justify-center text-white shadow-lg ">
                       {/* Using generic icons for consistency */}
                       <svg xmlns="http://www.w3.org/2000/svg" class="w-6 h-6" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round">
                          {index === 0 && (
                             // Upload
                             <><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/><polyline points="17 8 12 3 7 8"/><line x1="12" y1="3" x2="12" y2="15"/></>
                          )}
                          {index === 1 && (
                             // Clock / Time
                             <><circle cx="12" cy="12" r="10"/><polyline points="12 6 12 12 16 14"/></>
                          )}
                          {index === 2 && (
                             // Rotation / Repeat
                             <><path d="M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8"/><path d="M3 3v5h5"/></>
                          )}
                          {index === 3 && (
                             // Update / Edit
                             <><path d="M12 20h9"/><path d="M16.5 3.5a2.12 2.12 0 0 1 3 3L7 19l-4 1 1-4Z"/></>
                          )}
                        </svg>
                    </div>
                  </div>
                  
                  <!-- Text -->
                  <div class="pt-3">
                    <h4 class="text-xl md:text-2xl font-bold font-outfit text-white mb-2">
                      {step.title}
                    </h4>
                    <p class="text-blue-100/80 text-lg leading-relaxed">
                      {step.desc}
                    </p>
                  </div>
                </div>
              ))
            }
          </div>
        </div>
    </div>
  </div>
</section>

<script>
  import { gsap } from "gsap";
  import { ScrollTrigger } from "gsap/ScrollTrigger";

  gsap.registerPlugin(ScrollTrigger);

  gsap.to(".hiw-image", {
    scrollTrigger: {
      trigger: ".hiw-image",
      start: "top 80%",
    },
    y: 0,
    opacity: 1,
    duration: 0.8,
    ease: "power2.out",
  });

  gsap.to(".hiw-step", {
    scrollTrigger: {
      trigger: ".hiw-step",
      start: "top 80%",
    },
    x: 0,
    opacity: 1,
    duration: 0.6,
    stagger: 0.2,
    ease: "power2.out",
  });
</script>

<style>
  :global([data-theme="light"]) #how-it-works-section {
    background: #ffffff;
  }
  :global([data-theme="light"]) #how-it-works-inner {
    background: #f8fafc; /* slate-50 */
    border: 1px solid #e2e8f0;
  }
  :global([data-theme="light"]) h2,
  :global([data-theme="light"]) h4 {
    color: #000000;
  }
  :global([data-theme="light"]) p {
    color: #4b5563; /* gray-600 */
  }
</style>
