---
import type { CollectionEntry } from "astro:content";
import { Image } from "astro:assets";
import stepVector from "../assets/howItWorks/step_vector.svg";
import mainImage from "../assets/howItWorks/happy-couple-using-laptop-together-yellow-backdrop 1.png";
type Props = NonNullable<CollectionEntry<"pages">["data"]["howItWorks"]>;

const { label, title, image, steps } = Astro.props as Props;
---

<section id="how-it-works-section" class="bg-gradient-to-br from-[#050a1f] via-blue-900 to-blue-800 p-[25px] w-full transition-colors duration-300">
  <div id="how-it-works-inner" class="bg-white rounded-[3rem] py-20 transition-colors duration-300">
    <div class="max-w-7xl mx-auto px-4 md:px-8 relative z-10">
        
        <!-- Header -->
        <div class="text-center mb-16">
          <span class="text-blue-400 font-bold uppercase tracking-widest text-sm mb-2 block">
            {label}
          </span>
          <h2 class="text-4xl md:text-5xl font-bold font-outfit">
            {title}
          </h2>
        </div>

        <div class="grid grid-cols-1 lg:grid-cols-2 gap-12 lg:gap-20 items-center">
          
          <!-- Image Section -->
          <div class="relative hiw-image opacity-0 translate-y-8 flex justify-center lg:block">
             <div class="relative">
                <!-- Data Container: 506x555 -->
                <div class="hidden lg:block w-[506px] h-[555px] bg-gradient-to-br from-[#3253CC] to-[#011661] rounded-[20px]"></div>
                
                <!-- Image: 593x448, positioned to go out -->
                <div class="lg:absolute lg:bottom-0 lg:left-0 w-full max-w-[593px] h-auto lg:h-[448px] rounded-[20px] overflow-hidden">
                  <Image
                    src={mainImage}
                    alt="How it works"
                    class="w-full h-full object-cover"
                  />
                </div>
             </div>
          </div>

          <!-- Steps Section -->
          <div class="space-y-0 relative">
            <!-- Continuous Vertical Line -->
            <div class="absolute left-8 top-8 bottom-8 w-px border-l-2 border-dashed border-gray-600 hidden md:block"></div>

            {
              steps.map((step, index) => (
                <div class="hiw-step flex gap-6 md:gap-8 relative pb-12 last:pb-0 opacity-0 translate-x-8">
                  <!-- Icon -->
                  <div class="relative z-10 shrink-0">
                    <div class="w-16 h-16 rounded-full bg-[#EBEFFF] flex items-center justify-center text-white shrink-0 z-10 relative">
                       <Image src={stepVector} alt="Step Icon" class="w-8 h-8" />
                    </div>
                  </div>
                  
                  <!-- Text -->
                  <div class="pt-3">
                    <h4 class="text-xl md:text-2xl font-semibold font-outfit text-[#3253CC] mb-2">
                      {step.title}
                    </h4>
                    <p class="text-lg leading-relaxed">
                      {step.desc}
                    </p>
                  </div>
                </div>
              ))
            }
          </div>
        </div>
    </div>
  </div>
</section>

<script>
  import { gsap } from "gsap";
  import { ScrollTrigger } from "gsap/ScrollTrigger";

  gsap.registerPlugin(ScrollTrigger);

  gsap.to(".hiw-image", {
    scrollTrigger: {
      trigger: ".hiw-image",
      start: "top 80%",
    },
    y: 0,
    opacity: 1,
    duration: 0.8,
    ease: "power2.out",
  });

  gsap.to(".hiw-step", {
    scrollTrigger: {
      trigger: ".hiw-step",
      start: "top 80%",
    },
    x: 0,
    opacity: 1,
    duration: 0.6,
    stagger: 0.2,
    ease: "power2.out",
  });
</script>

<style>
  :global([data-theme="light"]) #how-it-works-section {
    background: #ffffff;
  }
  :global([data-theme="light"]) #how-it-works-inner {
    background: #f8fafc; /* slate-50 */
    border: 1px solid #e2e8f0;
  }
  :global([data-theme="light"]) h2,
  :global([data-theme="light"]) h4 {
    color: #000000;
  }
  :global([data-theme="light"]) p {
    color: #4b5563; /* gray-600 */
  }
</style>
